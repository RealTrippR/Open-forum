<!DOCTYPE html>
<html lang="en">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title> OpenForum Request Password Reset </title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/generalLogin.css">
</head>
<body>
    <div id="navbar"></div>
    <div id="copyright-div"> </div>
    <script src="/loadNavbar.js"></script>
    <script src="/loadCopyright.js"></script>

    <script>
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        window.onload = function() {
            loadNavbar();
            loadCopyright();
        };
    </script>

<div class="login-box" id="container">
    <p class='stdText' style='font-family: var(--stdHeaderFontFamily); font-size: 30px; font-weight: 600; text-shadow: var(--stdShadow); margin-bottom: -3px;'>OpenForum Password Reset</p>
    <br>
    <div class="errorText" id="error-msg" style="height: 12px"> </div>

    <form id="password-reset-form" >
      <input type="text" name="username" id="username" placeholder="Username" required><br>
      <input type="email" name="email" id="email" placeholder="Email" required><br>
    </form>

    <p id="error-msg" style="color: red; display: none;"></p>
    <button class='page-button' id = 'reset-button'> Request Password Reset </button>

</div>

<script>

const passwordResetButton = document.getElementById('reset-button');
passwordResetButton.addEventListener('click', async function (e) {
    e.preventDefault(); // Stop form submission

    const username = document.getElementById('username').value;
    const email = document.getElementById('email').value;
    const errorMsg = document.getElementById('error-msg');

    const res = await fetch('/request-password-reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: username, email: email })
    });

    console.log('res:',res)
    if (res.ok) {
        const div = document.getElementById('container');
        // overwrite inner HTML
        const HTML = `
        <p class='stdText'> A password reset link has been sent to ${escapeHtml(email)}
            `
        div.innerHTML = HTML;
        
    } else {
        // show error
        errorMsg.innerText = 'Incorrect username or email';
    }
});

</script>
</body>
</html>